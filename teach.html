<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
        import { getFirestore, query, collection, where, getDocs } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBhiboEoHCmdG4eHdBeUacUY6EKDZMiGj0",
            authDomain: "rankmaster-2007.firebaseapp.com",
            projectId: "rankmaster-2007",
            storageBucket: "rankmaster-2007.appspot.com",
            messagingSenderId: "481619433177",
            appId: "1:481619433177:web:5be2893aa094dbcc2b10c8",
            measurementId: "G-NXE1T8RZ7H"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        async function loadStudents() {
            const teacherEmail = localStorage.getItem("userEmail");
            const teacherQuery = query(collection(db, "students"), where("teacherEmail", "==", teacherEmail));
            const querySnapshot = await getDocs(teacherQuery);

            const studentList = document.getElementById("studentList");
            studentList.innerHTML = ""; // Clear existing list

            if (!querySnapshot.empty) {
                querySnapshot.forEach((doc) => {
                    const studentData = doc.data();
                    const studentItem = document.createElement("div");
                    studentItem.innerHTML = `
                        <h3>${studentData.name}</h3>
                        <p>Class: ${studentData.class}</p>
                        <p>Email: ${studentData.email}</p>
                        <button onclick="viewProfile('${studentData.email}')">View Profile</button>
                    `;
                    studentList.appendChild(studentItem);
                });
            } else {
                studentList.innerHTML = "<p>No students found.</p>";
            }
        }

        function viewProfile(email) {
            window.location.href = "profile.html?email=" + encodeURIComponent(email);
        }

        // Load students when the page is loaded
        window.onload = loadStudents;
    </script>
</head>
<body>
    <h1>Teacher Dashboard</h1>
    <div id="studentList">
        <p>Loading students...</p>
    </div>
    <button onclick="window.location.href='addstu.html'">Add Student</button>
    <button onclick="window.location.href='index.html'">Logout</button> <!-- Redirect to login page -->
</body>
</html>
